from main import classify, modify_dataset_mix, modify_dataset

data = []

scores = []
total = 0
ts = 0
bar = 0.95
worng_score = []
# plt.subplots(2, 3)
for i in [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]:
    for year in range(2010, 2023 - i):
        total += 1
        train_data, train_label, test_data, test_label = modify_dataset(year, year + i)
        score, accuracy, precision, recall, f1 = classify(train_data, train_label, test_data, test_label)
        if (score > bar and i > 2) or (score <= bar and i <= 2):
            ts += 1
        else:
            worng_score.append(score)

        if i <= 2:
            data.append((score, 0))
        else:
            data.append((score, 1))
        print(i, score, year, year + i)
        t = score
        if i > 0:
            total += 1
            train_data, train_label, test_data, test_label = modify_dataset(year + i, year)
            score, accuracy, precision, recall, f1 = classify(train_data, train_label, test_data, test_label)
            if (score > bar and i > 2) or (score <= bar and i <= 2):
                ts += 1
            else:
                worng_score.append(score)
            if i <= 2:
                data.append((score, 0))
            else:
                data.append((score, 1))
            print(i, score, year + i, year)

worng_score.sort()
print(worng_score)

print(ts / total)

max_acc = 0
s = 0
for i in range(5, 101, 1):
    count_t = 0
    sh = i / 100
    for d, l in data:
        if d > sh and l == 1:
            count_t += 1
        if d <= sh and l == 0:
            count_t += 1
    accuracy = count_t / len(data)
    if accuracy > max_acc:
        max_acc = accuracy
        s = sh
print('------------------')
print(max_acc)
print(s)
