import os


def find(year1, year2):
    path1 = f'good/%dgoodware-%dgoodware.txt' % (year1, year2)
    path2 = f'malware/%dmalware-%dmalware.txt' % (year1, year2)
    count = 0
    write_path = f'data/%d-%d.txt' % (year1, year2)
    with open(path1, 'r') as f1, open(path2, 'r') as f2, open(write_path, 'w') as f3:
        lines1 = f1.readlines()
        lines2 = f2.readlines()
        for line in lines1:
            for l in lines2:
                if l == line:
                    count += 1
                    f3.write(f'%s' % line)
                    print(line)
        f1.close()
        f2.close()
        f3.close()
    print(count)


def find_importance(year1, year2):
    path1 = f'goodware_importance/%dgoodware-%dgoodware.txt' % (year1, year2)
    path2 = f'malware_importance/%dmalware-%dmalware.txt' % (year1, year2)
    count = 0
    write_path = f'data_importance/%d-%d.txt' % (year1, year2)
    print(year1,year2)
    with open(path1, 'r') as f1, open(path2, 'r') as f2, open(write_path, 'w') as f3:
        lines1 = f1.readlines()
        lines2 = f2.readlines()
        for line in lines1:
            for l in lines2:
                if l.split(' ')[0] == line.split(' ')[0]:
                    count += 1
                    f3.write(f'%s %s %s\n' % (
                        l.split(' ')[0], abs(float(l.split(' ')[1])) / 2 + abs(float(line.split(' ')[1])) / 2,
                        int(l.split(' ')[2]) / 2 + int(line.split(' ')[2]) / 2))
                    print(line)
        f1.close()
        f2.close()
        f3.close()
    print(count)


def write_to_txt():
    set = {}
    f_list = os.listdir('./data')
    with open('../total_2010-2022_50_2.txt', 'w') as f0:
        for f in f_list:
            with open(os.path.join('./data', f), 'r') as file:
                for line in file.readlines():
                    set[f'%s' % line] = 0
                file.close()
        for key in set.keys():
            f0.write(key)
        f0.close()


def write_to_txt_importance():
    set_feature = {}
    feature_count = {}
    f_list = os.listdir('./data_importance')
    with open('../total_2010-2022_75_importance.txt', 'w') as f0:
        for f in f_list:
            with open(os.path.join('./data_importance', f), 'r') as file:
                for line in file.readlines():
                    set_feature[f'%s' % line.split(' ')[0]] = 0
                    feature_count[f'%s' % line.split(' ')[0]] = 0
                file.close()
        for f in f_list:
            with open(os.path.join('./data_importance', f), 'r') as file:
                for line in file.readlines():
                    set_feature[f'%s' % line.split(' ')[0]] += float(line.split(' ')[1])
                    feature_count[f'%s' % line.split(' ')[0]] += 1
                file.close()
        for key, value in set_feature.items():
            f0.write(f'%s %f\n' % (key, value / feature_count[key]))
        f0.close()


if __name__ == '__main__':
    # for year1 in range(2010, 2023):
    #     for year2 in range(year1 + 1, 2023):
    #         find_importance(year1, year2)



    write_to_txt_importance()
